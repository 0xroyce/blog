<%- include('../partials/header') %>

<div class="container">
    <h1>Menu Manager</h1>

    <form action="/admin/menu/create" method="POST">
        <h2>Add New Menu Item</h2>
        <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>
        </div>
        <div>
            <label for="url">URL:</label>
            <input type="text" id="url" name="url" required>
        </div>
        <div>
            <label for="orderIndex">Order:</label>
            <input type="number" id="orderIndex" name="orderIndex" required>
        </div>
        <div>
            <label for="parentId">Parent Item:</label>
            <select id="parentId" name="parentId">
                <option value="">None</option>
                <% menuItems.forEach(item => { %>
                    <option value="<%= item.id %>"><%= item.title %></option>
                <% }) %>
            </select>
        </div>
        <button type="submit">Add Menu Item</button>
    </form>

    <h2>Current Menu Structure</h2>
    <ul id="menu-structure">
        <% function renderMenuItems(items) { %>
            <% items.forEach(item => { %>
                <li>
                    <%= item.title %> (<%= item.url %>)
                    <form action="/admin/menu/update" method="POST" style="display: inline;">
                        <input type="hidden" name="id" value="<%= item.id %>">
                        <input type="text" name="title" value="<%= item.title %>" required>
                        <input type="text" name="url" value="<%= item.url %>" required>
                        <input type="number" name="orderIndex" value="<%= item.order_index %>" required>
                        <select name="parentId">
                            <option value="">None</option>
                            <% menuItems.forEach(menuItem => { %>
                                <% if (menuItem.id !== item.id) { %>
                                    <option value="<%= menuItem.id %>" <%= menuItem.id === item.parent_id ? 'selected' : '' %>><%= menuItem.title %></option>
                                <% } %>
                            <% }) %>
                        </select>
                        <button type="submit">Update</button>
                    </form>
                    <form action="/admin/menu/delete/<%= item.id %>" method="POST" style="display: inline;">
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this menu item?')">Delete</button>
                    </form>
                    <% if (item.children && item.children.length > 0) { %>
                        <ul>
                            <%= renderMenuItems(item.children) %>
                        </ul>
                    <% } %>
                </li>
            <% }) %>
        <% } %>
        <%= renderMenuItems(menuItems) %>
    </ul>
</div>

<%- include('../partials/footer') %>